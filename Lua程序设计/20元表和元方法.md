
# 20 元表和元方法
- Lua语言在创建新表时不带元表，可以使用函数setmetatable来设置或修改任意表得元表。
- 一个表可以成为任意值得元表；一组相关的表也可以共享一个描述他们共同行为的通用元表(例如读excel，每一行使用一个table，共享一个带有表头的原来读去数据)；

## 20.1 算术运算相关的元方法
- 每种算术运算符都有一个对应的元方法。
加法（__add），乘法（__mul），还有减法（__sub）、除法（__div）、floor除法（__idiv）、负数（__unm）、取模（__mod）和幂运算（__pow）。类似地，位操作也有元方法：按位与（__band）、按位或（__bor）、按位异或（__bxor）、按位取反（__bnot）、向左移位（__shl）和向右移位（__shr）。我们还可以使用字段__concat来定义连接运算符的行为。
## 20.2 关系运算符的元方法
- 包括等于（__eq）、小于（__lt）和小于等于（__le）。其他三个关系运算符没有单独的元方法，Lua语言会将a～=b转换为not（a==b），a>b转换为b<a，a>=b转换为b<=a
## 20.3 库定义相关的元方法

## 20.4 表相关的元方法
- 表的元方法可让让我们访问和修改表中不存在的字段

### 20.4.1 __index元方法
- 元方法__index可以模拟OOP实现继承。元方法__index还可以是一个表，此时访问表中不存的键时就会访问这个表
- 如果不希望希望__index元方法被调用，可以使用rawget（t,i）会对表t进行原始（raw）的访问

### 20.4.2 __newindex元方法
- 当对一个表中不存在的索引赋值时，解释器就会查找__newindex元方
- 如果这个元方法是一个表，解释器就在此表中执行赋值，而不是在原始的表中进行赋值。此外
- 调用rawset（t,k,v）可以绕过元方法，等价于t[k]=v。

### 20.4.3 具有默认值的表
- 一个普通表中所有字段的默认值都是nil。通过元表，可以修改这个默认值
